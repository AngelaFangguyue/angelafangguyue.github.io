<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noodp" />
  
  <meta name="author" content="AngelaFang" />
  
  <link rel="prev" href="http://angelafang.top/2019/js%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" />
  
  <link rel="next" href="http://angelafang.top/2019/js%E5%85%A8%E8%A7%A3%E5%AE%9E%E6%88%98%E4%B9%8B%E5%A4%AA%E6%9E%81/" />
  
  <link rel="canonical" href="http://angelafang.top/2019/js%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
  <meta name="msapplication-TileColor" content="#da532c" />
  <meta name="theme-color" content="#ffffff" />
  <title>
    
    
    Js函数的执行时机 | Angela Fang&#39;s Blog
    
  </title>
  <meta name="title" content="Js函数的执行时机 | Angela Fang&#39;s Blog"/>
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "http:\/\/angelafang.top\/"
    },
    "articleSection" : "posts",
    "name" : "Js函数的执行时机",
    "headline" : "Js函数的执行时机",
    "description" : "本篇文章介绍 js 函数的执行时机,主要内容有：\n1:为什么会打印出 6 个 6\n2:怎样打印出 0,1,2,3,4,5\n3:其他的方法\n4:碎碎念\n请看下面的代码：\nlet i=0; for(i=0;i\x26lt;6;i\x2b\x2b){ console.log(i); }  执行后的结果： 再看下面这个代码：\nlet i=0; for(i=0;i\x26lt;6;i\x2b\x2b){ setTimeout(()=\x26gt;console.log(i),10); }  执行后的结果： 上面两个结果不同，原因在哪里？原因就出在 setTimeout 这个函数上面。 \x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;最上面的代码，它的执行时机是按照顺序，依次执行，循环一下，打印一下 i 的值。\n\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;但是 setTimeout 函数,是异步任务，执行到这里的操作会被浏览器丢到另一个任务队列里去。 浏览器这时候会继续执行 for 循环。每一次 for 循环的时候，setTimeout 都执行一次，但是里面的函数没有被执行，而是被放到了任务队列里面，等待执行。for 循环了 6 次，就放了 6 次，当主线程执行完成后，才进入任务队列里面执行。这时候因为 for 循环 i=6 了，所以输出的全部都是 6。\n\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;如何理解异步呢？异步代码不等待结果，直接进行下面的代码，所以定时器只是开启了，而没有立即执行里面的代码，等到当前运行坏境的代码执行完之后再回来执行定时器里面的代码。总结：异步就是不等待结果的代码。\n\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;（setTimeout(语句 W,10)这里的 10 表示是等待现在的代码执行完，10 毫秒后就立即执行 setTimeout 里面的语句 W，若为数字 X，表示执行完现在的代码，等待 X 毫秒后，去执行语句 W）。\n那么如何才能在第二个代码中，让它的结果也能依次输出 0，1，2，3，4，5 呢？ \x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;js 给我们提供了 let 和 for 搭配使用，就可以办到。原理：let 为代码块的作用域，所以每一次 for 循环，console.",
    "inLanguage" : "zh-Hans",
    "author" : "AngelaFang",
    "creator" : "AngelaFang",
    "publisher": "AngelaFang",
    "accountablePerson" : "AngelaFang",
    "copyrightHolder" : "AngelaFang",
    "copyrightYear" : "2019",
    "datePublished": "2019-12-06 08:45:30 \x2b0800 CST",
    "dateModified" : "2019-12-06 08:45:30 \x2b0800 CST",
    "url" : "http:\/\/angelafang.top\/2019\/js%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA\/",
    "wordCount" : "189",
    "keywords" : [ "js js函数 同步 异步 闭包 作用域 立即执行函数", "Angela Fang\x27s Blog"]
}
</script>

</head>




  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://angelafang.top/">Angela Fang&#39;s Blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://angelafang.top/">Angela Fang&#39;s Blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Js函数的执行时机</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="http://angelafang.top/" rel="author">AngelaFang</a> with ♥ 
                <span class="post-time">
                on <time datetime=2019-12-06 itemprop="datePublished">December 6, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<p>本篇文章介绍 js 函数的执行时机,主要内容有：<br />
<a href="#a1">1:为什么会打印出 6 个 6</a><br />
<a href="#a2">2:怎样打印出 0,1,2,3,4,5</a><br />
<a href="#a3">3:其他的方法</a><br />
<a href="#a4">4:碎碎念</a></p>

<hr />

<p><strong>请看下面的代码：</strong></p>

<pre><code>let i=0;
for(i=0;i&lt;6;i++){
console.log(i);
}
</code></pre>

<p>执行后的结果：
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/task28/for1.PNG" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure>
<strong>再看下面这个代码：</strong></p>

<pre><code>let i=0;
for(i=0;i&lt;6;i++){
setTimeout(()=&gt;console.log(i),10);
}
</code></pre>

<p>执行后的结果：
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/task28/for2.PNG" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<hr />

<h3 id="a1"><strong>上面两个结果不同，原因在哪里？原因就出在 setTimeout 这个函数上面。</strong></h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red">最上面的代码，它的执行时机是按照顺序，依次执行，循环一下，打印一下 i 的值。</span></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red">但是 setTimeout 函数,是异步任务，执行到这里的操作会被浏览器丢到另一个任务队列里去。 浏览器这时候会继续执行 for 循环。每一次 for 循环的时候，setTimeout 都执行一次，但是里面的函数没有被执行，而是被放到了任务队列里面，等待执行。for 循环了 6 次，就放了 6 次，当主线程执行完成后，才进入任务队列里面执行。这时候因为 for 循环 i=6 了，所以输出的全部都是 6。</span></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red">如何理解异步呢？异步代码不等待结果，直接进行下面的代码，所以定时器只是开启了，而没有立即执行里面的代码，等到当前运行坏境的代码执行完之后再回来执行定时器里面的代码。总结：异步就是不等待结果的代码。</span></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red">（setTimeout(语句 W,10)这里的 10 表示是等待现在的代码执行完，10 毫秒后就立即执行 setTimeout 里面的语句 W，若为数字 X，表示执行完现在的代码，等待 X 毫秒后，去执行语句 W）</span>。</p>

<hr />

<h3 id="a2"><strong>那么如何才能在第二个代码中，让它的结果也能依次输出 0，1，2，3，4，5 呢？</strong></h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:red">js 给我们提供了 let 和 for 搭配使用，就可以办到。原理：let 为代码块的作用域，所以每一次 for 循环，console.log(i); 都引用到 for 代码块作用域下的 i，因为这样被引用，所以 for 循环结束后，这些作用域在 setTimeout 未执行前都不会被释放。</span></p>

<pre><code>for(let i=0;i&lt;6;i++){
   setTimeout(()=&gt;console.log(i),10); console.log(i);
}
</code></pre>

<p>执行后的结果：
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/task28/for3.PNG" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<p><i>注意：这里的 i 变量是在 for 循环内部声明定义的！！！</i></p>

<hr />

<h3 id="a3"><strong>可以使用闭包来解决这个问题（原理是声明了立即执行函数，保存了当时的值到内部。这样 console.log(i); 中的 i 就保存在每一次循环生成的立刻执行函数中的作用域里了），也可以借助 setTimeout 函数的第三个参数来实现（参考<a href="https://www.jb51.net/article/122489.htm" rel="nofollow noreferrer" target="_blank">文章 1</a> <a href="https://www.cnblogs.com/huchong-bk/p/11757786.html" rel="nofollow noreferrer" target="_blank">文章 2</a> <a href="https://www.cnblogs.com/wangwenhui/p/7657654.html" rel="nofollow noreferrer" target="_blank">文章 3</a>）</strong></h3>

<pre><code>for(var i=0;i&lt;6;i++&gt;){
        (function(i){   //立即执行函数
            setTimeout(function(){console.log(i);},0);
            })(i);
}
</code></pre>

<p>执行后的结果：
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/task28/for4.PNG" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure>
<span style="font-size:14px">除了使用闭包（立即执行函数），还可以使用 setTimeout 函数的第三个参数，将 i 传过去，</span></p>

<pre><code>let i = 0;
for(i=0;i&lt;6;i++){
    setTimeout(function(value){console.log(value)},10,i);
}
</code></pre>

<p>执行后的结果：
<figure><img src="/images/ring.svg" data-sizes="auto" data-src="/images/task28/for5.PNG" alt="" class="lazyload"><figcaption class="image-caption"></figcaption></figure></p>

<hr />

<h3 id="a4">上面的代码，涉及到了 js 执行时异步（同步），闭包（立即执行函数），作用域等这些知识点。</h3>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b style="color:red">分析上面的代码，setTimeout 是异步执行，10ms 后往任务队列里面添加一个任务，只有主线上的全部执行完，才会执行任务队列里的任务，当主线执行完成后，i 是 6，所以此时再去执行任务队列里的任务时，i 全部是 6 了。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对于打印 6 次是：每一次 for 循环的时候，setTimeout 都执行一次，但是里面的函数没有被执行，而是被放到了任务队列里面，等待执行，for 循环了 6 次，就放了 6 次，当主线程执行完成后，才进入任务队列里面执行。（注意：for 循环从开始到结束的过程，需要维持几微秒或几毫秒。)</p>

<p>当我把 var 变成 let 时</p>

<pre><code> for(let i = 0;i &lt; 6;i++){
 setTimeout(function() { console.log(i)},0);
 }
</code></pre>

<p>打印出的是：0,1,2,3,4,5</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;当解决变量作用域后：因为 for 循环头部的 let 不仅将 i 绑定到 for 循环块中，事实上它将其重新绑定到循环体的每一次迭代中，确保上一次迭代结束的值重新被赋值。setTimeout 里面的 function()属于一个新的域，通过 var 定义的变量是无法传入到这个函数执行域中的，通过使用 let 来声明块变量，这时候变量就能作用于这个块，所以 function 就能使用 i 这个变量了；这个匿名函数的参数作用域 和 for 参数的作用域 不一样，是利用了这一点来完成的。这个匿名函数的作用域有点类似类的属性，是可以被内层方法使用的。</b></p>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>AngelaFang </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=http://angelafang.top/2019/js%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA/>http://angelafang.top/2019/js%E5%87%BD%E6%95%B0%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E6%9C%BA/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="http://angelafang.top/tags/js-js%E5%87%BD%E6%95%B0-%E5%90%8C%E6%AD%A5-%E5%BC%82%E6%AD%A5-%E9%97%AD%E5%8C%85-%E4%BD%9C%E7%94%A8%E5%9F%9F-%E7%AB%8B%E5%8D%B3%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0/">
                    #js js函数 同步 异步 闭包 作用域 立即执行函数</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="http://angelafang.top/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="http://angelafang.top/2019/js%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/" class="prev" rel="prev" title="Js基本语法"><i class="iconfont icon-left"></i>&nbsp;Js基本语法</a>
         
        
        <a href="http://angelafang.top/2019/js%E5%85%A8%E8%A7%A3%E5%AE%9E%E6%88%98%E4%B9%8B%E5%A4%AA%E6%9E%81/" class="next" rel="next" title="Js全解实战之太极">Js全解实战之太极&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2011 - 2020</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="http://angelafang.top/">AngelaFang</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
